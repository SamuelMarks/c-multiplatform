vcpkg_from_github(
    OUT_SOURCE_PATH SOURCE_PATH
    REPO SamuelMarks/c-multiplatform
    REF e7be20e2583a21df1b0189c810cb7a969705e023
    SHA512 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
    HEAD_REF main
)

vcpkg_check_features(OUT_FEATURE_OPTIONS FEATURE_OPTIONS
    FEATURES
        sdl3 M3_ENABLE_SDL3
        sdl3-ttf M3_ENABLE_SDL3_TTF
        gtk4 M3_ENABLE_GTK4
        cocoa M3_ENABLE_COCOA
        win32 M3_ENABLE_WIN32
        web M3_ENABLE_WEB
        webgpu M3_ENABLE_WEBGPU
        ios M3_ENABLE_IOS
        android M3_ENABLE_ANDROID
        libcurl M3_ENABLE_LIBCURL
        apple-cfnetwork-c M3_APPLE_USE_CFNETWORK_C
)

if(VCPKG_LIBRARY_LINKAGE STREQUAL "dynamic")
    set(M3_BUILD_SHARED ON)
else()
    set(M3_BUILD_SHARED OFF)
endif()

vcpkg_cmake_configure(
    SOURCE_PATH "${SOURCE_PATH}"
    OPTIONS
        -DBUILD_SHARED_LIBS=${M3_BUILD_SHARED}
        -DBUILD_TESTING=OFF
        -DM3_WARNINGS_AS_ERRORS=OFF
        -DM3_ENABLE_COVERAGE=OFF
        -DM3_REQUIRE_DOXYGEN=OFF
        ${FEATURE_OPTIONS}
)

vcpkg_cmake_install()
vcpkg_cmake_config_fixup(CONFIG_PATH lib/cmake/LibM3C)

file(REMOVE_RECURSE "${CURRENT_PACKAGES_DIR}/debug/share")

vcpkg_install_copyright(
    FILE_LIST "${SOURCE_PATH}/LICENSE"
)
